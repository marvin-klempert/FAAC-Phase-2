(function(){})();function kocujILV12aCBackendSettingsFormArray(){"use strict";var self=this;self._objHelper=kocujILV12aHelper;self._objDataHelper=kocujILV12aDataHelper;self._thisFilename=document.scripts[document.scripts.length-1].src;var vals=kocujILV12aBackendSettingsFormArrayVals;if(vals.throwErrors==="1"){self._valsThrowErrors=true}else{self._valsThrowErrors=false}self._valsHtmlIdFormatArrayContainer=vals.htmlIdFormatArrayContainer;self._valsTextButtonAddNewElement=vals.textButtonAddNewElement;self._valsDivElementContainer=vals.divElementContainer;self._valsDivField=vals.divField;self._valsDivControls=vals.divControls;self._valsImageArrowDown=vals.imageArrowDown;self._valsImageArrowUp=vals.imageArrowUp;self._valsImageDelete=vals.imageDelete;self._valsImageEmpty=vals.imageEmpty}kocujILV12aCBackendSettingsFormArray.prototype={_objHelper:null,_objDataHelper:null,_thisFilename:"",_prj:[],_valsThrowErrors:false,_valsHtmlIdFormatArrayContainer:"",_valsTextButtonAddNewElement:"",_valsDivElementContainer:"",_valsDivField:"",_valsDivControls:"",_valsImageArrowDown:"",_valsImageArrowUp:"",_valsImageDelete:"",_valsImageEmpty:"",addProject:function(projectId,projectName){"use strict";var args=this._checkAddProject(projectId,projectName);if(this._prj["prj_"+args.projectId]===undefined){this.addProjectIfNotExists(args.projectId,args.projectName)}else{this._throwError("PROJECT_ALREADY_EXISTS",args.projectId);return}},addProjectIfNotExists:function(projectId,projectName){"use strict";var args=this._checkAddProject(projectId,projectName);if(this._prj["prj_"+args.projectId]===undefined){this._prj["prj_"+args.projectId]={projectName:args.projectName,arrays:[]}}},getHTMLSelectorArrayContainer:function(projectId,formId,fieldId){"use strict";projectId=this._parseProjectId(projectId);formId=this._objHelper.initString(formId);fieldId=this._objHelper.initString(fieldId);return"#"+this._getHTMLNameArrayContainer(projectId,formId,fieldId)},getHTMLSelectorArrayElementContainer:function(projectId,formId,fieldId,number){"use strict";projectId=this._parseProjectId(projectId);formId=this._objHelper.initString(formId);fieldId=this._objHelper.initString(fieldId);number=this._objHelper.initNumeric(number);return"#"+this._getHTMLNameArrayContainer(projectId,formId,fieldId)+' div[data-type="element-container"][data-number="'+number+'"]'},getHTMLSelectorArrayEmptyElementContainer:function(projectId,formId,fieldId){"use strict";projectId=this._parseProjectId(projectId);formId=this._objHelper.initString(formId);fieldId=this._objHelper.initString(fieldId);return"#"+this._getHTMLNameArrayContainer(projectId,formId,fieldId)+' div[data-type="element-container"][data-next="na"]'},getHTMLSelectorArrayElementContainerFieldDiv:function(projectId,formId,fieldId,number){"use strict";projectId=this._parseProjectId(projectId);formId=this._objHelper.initString(formId);fieldId=this._objHelper.initString(fieldId);number=this._objHelper.initNumeric(number);return this.getHTMLSelectorArrayElementContainer(projectId,formId,fieldId,number)+' div[data-type="field"]'},getHTMLSelectorArrayElementContainerFieldValue:function(projectId,formId,fieldId,number){"use strict";projectId=this._parseProjectId(projectId);formId=this._objHelper.initString(formId);fieldId=this._objHelper.initString(fieldId);number=this._objHelper.initNumeric(number);return this.getHTMLSelectorArrayElementContainer(projectId,formId,fieldId,number)+' [data-type="field-value"]'},getHTMLSelectorArrayElementContainerControlsDiv:function(projectId,formId,fieldId,number){"use strict";projectId=this._parseProjectId(projectId);formId=this._objHelper.initString(formId);fieldId=this._objHelper.initString(fieldId);number=this._objHelper.initNumeric(number);return this.getHTMLSelectorArrayElementContainer(projectId,formId,fieldId,number)+' div[data-type="controls"]'},getHTMLSelectorArrayElementArrowDown:function(projectId,formId,fieldId,number){"use strict";projectId=this._parseProjectId(projectId);formId=this._objHelper.initString(formId);fieldId=this._objHelper.initString(fieldId);number=this._objHelper.initNumeric(number);return this.getHTMLSelectorArrayElementContainer(projectId,formId,fieldId,number)+' div[data-type="controls"] a[data-type="down"]'},getHTMLSelectorArrayElementArrowUp:function(projectId,formId,fieldId,number){"use strict";projectId=this._parseProjectId(projectId);formId=this._objHelper.initString(formId);fieldId=this._objHelper.initString(fieldId);number=this._objHelper.initNumeric(number);return this.getHTMLSelectorArrayElementContainer(projectId,formId,fieldId,number)+' div[data-type="controls"] a[data-type="up"]'},getHTMLSelectorArrayElementDelete:function(projectId,formId,fieldId,number){"use strict";projectId=this._parseProjectId(projectId);formId=this._objHelper.initString(formId);fieldId=this._objHelper.initString(fieldId);number=this._objHelper.initNumeric(number);return this.getHTMLSelectorArrayElementContainer(projectId,formId,fieldId,number)+' div[data-type="controls"] a[data-type="delete"]'},process:function(projectId,formId,fieldId,emptyField,elementsCount,arraySettings){"use strict";var self=this;(function($){projectId=self._parseProjectId(projectId);formId=self._objHelper.initString(formId);fieldId=self._objHelper.initString(fieldId);emptyField=self._objHelper.initString(emptyField);elementsCount=self._objHelper.initNumeric(elementsCount);arraySettings=self._objHelper.initObject(arraySettings);var id=self._prj["prj_"+projectId].arrays.length;self._prj["prj_"+projectId].arrays["arr_"+id]={formId:formId,fieldId:fieldId,arraySettings:arraySettings,emptyField:emptyField,newNumber:elementsCount};self._objDataHelper.setDataInDom($(self.getHTMLSelectorArrayContainer(projectId,formId,fieldId)),"array-id",id);for(var z=0;z<elementsCount;z++){var prevNumber="";if(z>0){prevNumber=z-1}var nextNumber="";if(z<elementsCount-1){nextNumber=z+1}self._updateControls(projectId,id,z,true,prevNumber,true,nextNumber)}if(arraySettings.autoadddeleteifempty){self._addNewEmptyField(projectId,formId,fieldId)}if(arraySettings.addnewbutton){var selectorArrayContainer=$(self.getHTMLSelectorArrayContainer(projectId,formId,fieldId));selectorArrayContainer.append('<div data-type="add-new-button"><input type="button" class="button" value="'+self._valsTextButtonAddNewElement+'" /></div>');selectorArrayContainer.find('div[data-type="add-new-button"] input').bind("click",{self:self,projectId:projectId,formId:formId,fieldId:fieldId},function(event){event.preventDefault();if($(event.data.self.getHTMLSelectorArrayEmptyElementContainer(event.data.projectId,event.data.formId,event.data.fieldId)).length===0){event.data.self._addNewEmptyField(event.data.projectId,event.data.formId,event.data.fieldId);$(this).insertAfter($(event.data.self.getHTMLSelectorArrayEmptyElementContainer(event.data.projectId,event.data.formId,event.data.fieldId)))}})}})(jQuery)},_getHTMLNameArrayContainer:function(projectId,formId,fieldId){"use strict";return this._valsHtmlIdFormatArrayContainer.replace("####FORM_ID####",formId).replace("####FIELD_ID####",fieldId)},_parseProjectId:function(projectId){"use strict";projectId=this._objHelper.initString(projectId);if(projectId===""){this._throwError("EMPTY_PROJECT_ID");return}if(this._prj["prj_"+projectId]===undefined){this._throwError("PROJECT_DOES_NOT_EXIST",projectId);return}return projectId},_checkAddProject:function(projectId,projectName){"use strict";projectId=this._objHelper.initString(projectId);if(projectId===""){this._throwError("EMPTY_PROJECT_ID");return}projectName=this._objHelper.initString(projectName);return{projectId:projectId,projectName:projectName}},_throwError:function(codeString,param){"use strict";codeString=this._objHelper.initString(codeString);if(codeString===""){return}param=this._objHelper.initString(param);if(this._valsThrowErrors){eval("throw new kocujILV12aCException(kocujILV12aExceptionCode."+codeString+", this._thisFilename, param);")}},_updateControls:function(projectId,arrayId,number,changePrevNumber,prevNumber,changeNextNumber,nextNumber){"use strict";var self=this;(function($){var arrayData=self._prj["prj_"+projectId].arrays["arr_"+arrayId];var selectorArrayElementArrowDown=$(self.getHTMLSelectorArrayElementArrowDown(projectId,arrayData.formId,arrayData.fieldId,number));var selectorArrayElementArrowUp=$(self.getHTMLSelectorArrayElementArrowUp(projectId,arrayData.formId,arrayData.fieldId,number));var selectorArrayElementDelete=$(self.getHTMLSelectorArrayElementDelete(projectId,arrayData.formId,arrayData.fieldId,number));if(selectorArrayElementArrowDown.length>0){selectorArrayElementArrowDown.remove()}if(selectorArrayElementArrowUp.length>0){selectorArrayElementArrowUp.remove()}if(selectorArrayElementDelete.length>0){selectorArrayElementDelete.remove()}var arraySettings=arrayData.arraySettings;var selectorArrayElementContainer=$(self.getHTMLSelectorArrayElementContainer(projectId,arrayData.formId,arrayData.fieldId,number));var selectorArrayElementContainerControls=$(self.getHTMLSelectorArrayElementContainerControlsDiv(projectId,arrayData.formId,arrayData.fieldId,number));self._objDataHelper.setDataInDom(selectorArrayElementContainer,"number",number);if(changePrevNumber){self._objDataHelper.setDataInDom(selectorArrayElementContainer,"prev",prevNumber)}if(changeNextNumber){self._objDataHelper.setDataInDom(selectorArrayElementContainer,"next",nextNumber)}var buttonsLink='<a href="#" data-type="####DATA_TYPE####"><img src="####IMAGE_URL####" alt="" style="float:left;border-width:0;border-style:none;" /></a>';var selector="";var imageUrl=self._valsImageEmpty;if(arraySettings.allowchangeorder&&selectorArrayElementContainer.data("next")!==""){selector=self.getHTMLSelectorArrayElementArrowDown(projectId,arrayData.formId,arrayData.fieldId,number);imageUrl=self._valsImageArrowDown}selectorArrayElementContainerControls.append(buttonsLink.replace("####DATA_TYPE####","down").replace("####IMAGE_URL####",imageUrl));if(selector!==""){$(selector).bind("click.element",{self:self,projectId:projectId,formId:arrayData.formId,fieldId:arrayData.fieldId},function(event){event.preventDefault();event.data.self._changeFields(event.data.projectId,event.data.formId,event.data.fieldId,parseInt($(this).parent().parent().data("number"),10),$(this).parent().parent().data("next"))})}selector="";imageUrl=self._valsImageEmpty;if(arraySettings.allowchangeorder&&selectorArrayElementContainer.data("prev")!==""){selector=self.getHTMLSelectorArrayElementArrowUp(projectId,arrayData.formId,arrayData.fieldId,number);imageUrl=self._valsImageArrowUp}selectorArrayElementContainerControls.append(buttonsLink.replace("####DATA_TYPE####","up").replace("####IMAGE_URL####",imageUrl));if(selector!==""){$(selector).bind("click.element",{self:self,projectId:projectId,formId:arrayData.formId,fieldId:arrayData.fieldId},function(event){event.preventDefault();event.data.self._changeFields(event.data.projectId,event.data.formId,event.data.fieldId,$(this).parent().parent().data("prev"),parseInt($(this).parent().parent().data("number"),10))})}selector="";imageUrl=self._valsImageEmpty;if(arraySettings.deletebutton){selector=self.getHTMLSelectorArrayElementDelete(projectId,arrayData.formId,arrayData.fieldId,number);imageUrl=self._valsImageDelete}selectorArrayElementContainerControls.append(buttonsLink.replace("####DATA_TYPE####","delete").replace("####IMAGE_URL####",imageUrl));if(selector!==""){$(selector).bind("click.element",{self:self,projectId:projectId,formId:arrayData.formId,fieldId:arrayData.fieldId},function(event){event.preventDefault();event.data.self._deleteField(event.data.projectId,event.data.formId,event.data.fieldId,parseInt($(this).parent().parent().data("number"),10))})}if(arraySettings.autoadddeleteifempty){$(self.getHTMLSelectorArrayElementContainerFieldValue(projectId,arrayData.formId,arrayData.fieldId,number)).bind("change.element",{self:self,projectId:projectId,formId:arrayData.formId,fieldId:arrayData.fieldId},function(event){event.preventDefault();if($(this).val()===""){event.data.self._deleteField(event.data.projectId,event.data.formId,event.data.fieldId,parseInt($(this).parent().parent().data("number"),10))}})}})(jQuery)},_changeFields:function(projectId,formId,fieldId,numberAbove,numberBelow){"use strict";var self=this;(function($){var arrayId=$(self.getHTMLSelectorArrayContainer(projectId,formId,fieldId)).data("array-id");var selectorArrayElementContainer1=$(self.getHTMLSelectorArrayElementContainer(projectId,formId,fieldId,numberAbove));var selectorArrayElementContainer2=$(self.getHTMLSelectorArrayElementContainer(projectId,formId,fieldId,numberBelow));selectorArrayElementContainer1.insertAfter(selectorArrayElementContainer2);var prev1=selectorArrayElementContainer1.data("prev");var prev2=selectorArrayElementContainer2.data("prev");var next1=selectorArrayElementContainer1.data("next");var next2=selectorArrayElementContainer2.data("next");if(prev1!==""){self._updateControls(projectId,arrayId,prev1,false,"",true,numberBelow)}if(next2!==""){self._updateControls(projectId,arrayId,next2,true,numberAbove,false,"")}self._updateControls(projectId,arrayId,numberAbove,true,numberBelow,true,next2);self._updateControls(projectId,arrayId,numberBelow,true,prev1,true,numberAbove)})(jQuery)},_deleteField:function(projectId,formId,fieldId,number){"use strict";var self=this;(function($){var selectorArrayElementContainer=$(self.getHTMLSelectorArrayElementContainer(projectId,formId,fieldId,number));var prevNumber=selectorArrayElementContainer.data("prev");var nextNumber=selectorArrayElementContainer.data("next");var arrayId=$(self.getHTMLSelectorArrayContainer(projectId,formId,fieldId)).data("array-id");if(prevNumber!==""){var selectorArrayElementContainerPrev=$(self.getHTMLSelectorArrayElementContainer(projectId,formId,fieldId,prevNumber));self._updateControls(projectId,arrayId,prevNumber,false,"",true,nextNumber)}if(nextNumber!==""){var selectorArrayElementContainerNext=$(self.getHTMLSelectorArrayElementContainer(projectId,formId,fieldId,nextNumber));self._updateControls(projectId,arrayId,nextNumber,true,prevNumber,false,"")}selectorArrayElementContainer.remove()})(jQuery)},_addNewEmptyField:function(projectId,formId,fieldId){"use strict";var self=this;(function($){var selectorArrayContainer=$(self.getHTMLSelectorArrayContainer(projectId,formId,fieldId));var arrayId=$(self.getHTMLSelectorArrayContainer(projectId,formId,fieldId)).data("array-id");var arrayData=self._prj["prj_"+projectId].arrays["arr_"+arrayId];selectorArrayContainer.append(self._valsDivElementContainer.replace("####DATA_TYPE_ELEMENT_CONTAINER####","element-container").replace("####DATA_ATTRS####",'data-number="" data-prev="na" data-next="na"')+self._valsDivField.replace("####DATA_TYPE_FIELD####","field")+arrayData.emptyField+"</div>"+self._valsDivControls.replace("####DATA_TYPE_CONTROLS####","controls")+'</div><div style="clear:both;"></div></div>');var selectorEmptyArrayElementContainer=selectorArrayContainer.find('div[data-type="element-container"]:last');self._objDataHelper.setDataInDom(selectorEmptyArrayElementContainer,"number",arrayData.newNumber);self._prj["prj_"+projectId].arrays["arr_"+arrayId].newNumber=arrayData.newNumber+1;selectorEmptyArrayElementContainer.find('[data-type="field-value"]').bind("change.empty",{self:self,projectId:projectId,formId:formId,fieldId:fieldId,arrayId:arrayId,arraySettings:arrayData.arraySettings},function(event){event.preventDefault();if($(this).val()!==""){var previous="";var selectorArrayElementContainer=selectorArrayContainer.find('div[data-type="element-container"][data-next=""]');if(selectorArrayElementContainer.length>0){previous=parseInt(selectorArrayElementContainer.data("number"),10);var number=parseInt($(this).parent().parent().data("number"),10);event.data.self._updateControls(event.data.projectId,event.data.arrayId,parseInt(selectorArrayElementContainer.data("number"),10),false,"",true,number)}event.data.self._updateControls(event.data.projectId,event.data.arrayId,parseInt($(this).parent().parent().data("number"),10),true,previous,true,"");if(event.data.arraySettings.autoadddeleteifempty){event.data.self._addNewEmptyField(event.data.projectId,event.data.formId,event.data.fieldId)}$(this).unbind("change.empty")}})})(jQuery)}};var kocujILV12aBackendSettingsFormArray=new kocujILV12aCBackendSettingsFormArray;